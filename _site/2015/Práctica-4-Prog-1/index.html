<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Práctica 4 Prog 1</title>
  <meta name="description" content="I love electronics.">
  <meta name="author" content="Ricardo Sanz">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Ricardo Sanz">
  <meta name="twitter:description" content="I love electronics.">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Ricardo Sanz">
  <meta property="og:description" content="I love electronics.">

  <link rel="apple-touch-icon" sizes="57x57" href="images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="images/favicons/manifest.json">
  <link rel="shortcut icon" href="images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="css/main.css">
  <link rel="canonical" href="http://ricardosa.nz/2015/Pr%C3%A1ctica-4-Prog-1/">
  <link rel="alternate" type="application/rss+xml" title="Ricardo Sanz" href="feed.xml">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(images/cover.jpg)">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/0.4.0/trianglify.min.js"></script>
  <script>
    // Create the Trianglify pattern
    var pattern = Trianglify({
        cell_size: Math.floor((Math.random() * 70) + 30),
        variance: (Math.random() * (0.25 - 1.00) + 1.00).toFixed(2),
        x_colors: 'BuPu',
        y_colors: 'match_x',
        palette: Trianglify.colorbrewer,
        stroke_width: 1.51,
    });

    // Serialize the SVG object to a String
    var m = new XMLSerializer().serializeToString(pattern.svg());

    // Perform the base64 encoding of the String
    var k = window.btoa(m);

    // Query the element to set the background image property
    var element = document.getElementsByTagName('header')[0];

    // Set the background image property, including the encoding type header
    element.style.backgroundImage = 'url("data:image/svg+xml;base64,' + k + '")';
  </script>
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="" title="link to home of Ricardo Sanz">
          <img src="images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Ricardo Sanz</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">I love electronics.</p>
        <!--<hr class="panel-cover__divider panel-cover__divider- -secondary">-->
        <hr class="panel-cover__divider">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="about" title="link to Ricardo Sanz about" class="blog-button">About</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="#blog" title="link to Ricardo Sanz blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/rsanzr" title="rsanzr on LinkedIn" target="_blank">
                  <i class='fa fa-linkedin-square'></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/rsre" title="rsre on GitHub" target="_blank">
                  <i class='fa fa-github-alt'></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:me@ricardosa.nz" title="Email me@ricardosa.nz" target="_blank">
                  <i class='fa fa-envelope'></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.instagram.com/rsrepictures" title="rsrepictures on Instagram" target="_blank">
                  <i class='fa fa-instagram'></i>
                  <span class="label">Instagram</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="feed.xml" title="Subscribe" target="_blank">
                <i class='fa fa-rss'></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="3 Jun 2015" class="post-meta__date date">3 Jun 2015</time><span class="post-meta__tags"><a href="tags/#ETSIST">ETSIST</a> </span>
    </div>
    <h1 class="post-title">Práctica 4 Prog 1</h1>
  </header>

  <section class="post">
    <h3 style="text-align: center;">ATTENTION: POSSIBLE SPAGHETTI CODE AHEAD</h3>
<p>Bueno, en vista de que el examen de recuperación de <strong>Programación I</strong> es dentro de un par de horas, supongo que no pasará nada si publico mi solución a la <strong>Práctica 4</strong> de esta asignatura que entregué en Enero de este año.</p>

<p>El enunciado decía lo siguiente:</p>
<blockquote>Se pretende codificar un programa que simule el manejo de una lista de impresoras. En cada impresora de la lista se encolarán los nombres de los ficheros a imprimir y se podrá dar órdenes para mandar los ficheros a imprimir, lo cual se simulará a través de la salida estándar (pantalla).</blockquote>
<div class="page" title="Page 3">
<div class="layoutArea">
<div class="column">
<blockquote>El programa se codificará en tres fases, que irán permitiendo al alumno ir probando el programa e irlo ampliando sobre código ya probado.
<ol>
	<li>PRIMERA FASE:
Codificar en C un programa colaImpresora.c que maneje una estructura de tipo cola en la que se almacenarán los nombres de los ficheros que se quieren imprimir.Los 6 nombres que se van a utilizar para generar los nombres de los ficheros, se pasarán al programa en el mandato de ejecución, y el programa los recibirá como parámetros de main(), de tal forma que la ejecución será:
<pre class="lang:sh decode:true ">C:\&gt; colaImpresora file1 file2 file3 file4 file5 file6
</pre>
Donde ficheroN es el nombre que el alumno asigne a un determinado fichero.</li>
	<li>SEGUNDA FASE:
Codificar en C un programa listaImpresoras.c que maneje una lista de impresoras.
Cada impresora se almacenará en una estructura con tres campos:
<ul>
	<li>nombre: identificador de la impresora. Cadena de 20 caracteres significativos.</li>
	<li>número de ficheros pendientes de impresión en la cola de la impresora.</li>
	<li>la cola de ficheros (resultante de la primera fase da la práctica).Inicialmente el programa leerá el nombre de seis ficheros que se pasará al programa en la ejecución, como parámetros de main(), de tal forma que la ejecución será:
<pre class="lang:sh decode:true">C:\&gt; listaImpresoras file1 file2 file3 file4 file5 file6</pre>
</li>
</ul>
</li>
	<li>TERCERA FASE:
  Se copiarán en el directorio en el que se vaya a codificar el programa fuente, los 6 ficheros de texto que se proporcionan en Moodle (a.txt b.txt c.txt d.txt e.txt f.txt).Se codificará un nuevo programa fuente listaImpresorasFicheros.c partiendo del código de listaImpresoras.c y realizando las siguientes modificaciones:Se modificarán las opciones 4. Imprimir un fichero y 5. Borrar una impresora, para que cada vez que se escriba por la salida estándar el nombre de un fichero, se escriba también el contenido del correspondiente fichero.Se modificará la opción 6. Salir, para que además de escribir el mensaje de despedida, se almacene en un fichero binario de nombre listaImpresoras.bin, el contenido de las posiciones ocupadas de la lista de impresoras para su uso en una sesión de trabajo posterior.Se modificará la función de inicialización de la lista, para que si el fichero listaImpresoras.bin existe, el contenido del fichero se añada en la lista de impresoras, ocupando las primeras posiciones de la lista.</li>
</ol>
</blockquote>
</div>
</div>
</div>

<p>En el momento de escribir el código planteé varias posibles soluciones: pasar todos los valores de un sitio a otro por referencia, hacer una máquina de estados con una impresora dónde solo se cambiaran las variables de la misma…pero al final me decidí por una opción fatídica que me acabó costando la nota: decidí usar variables globales.</p>

<p>Era un chollazo, me ahorraba andar pasando tantos parámetros y al fin y al cabo muchas funciones tenían que acceder a esos valores ¿por qué no declararlos para todo el programa y me quitaba de andar jugando con ellos? Pues resulta que las variables globales están prohibidisimas, algo que yo desconocía en el momento.</p>

<p>Entregué mi práctica muy confiado, habiendo entregado todas las partes optativas y cual fue mi sorpresa cuando publicaron la nota y me encontré un 0. Después de hablar con el profesor conseguí subir la nota a un aprobado porque después de todo <strong>sí que paso parámetros</strong> de todas las formas que nos han enseñado, ergo estaba demostrado que sabía pasar parámetros. También descubrí que el profesor pensaba que había <em>usado recursos extraños (sic)</em> en la parte optativa de ficheros, pero de eso hablaremos después.</p>

<p>Os dejo el código:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cm">/**************************************************************
*listaImpresorasFicheros.c
*Ricardo Sanz Retuerta
*Maneja una lista de impresoras imprimiendo ficheros
*y guarda el estado entre una ejecucion y otra
***************************************************************/</span>
<span class="cp">#include&amp;lt;stdio.h&amp;gt;
#include&amp;lt;string.h&amp;gt;
#include&amp;lt;stdlib.h&amp;gt;
#define COLA (10+1)
#define IMPRESORAS 4
</span>
<span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
  <span class="kt">char</span> <span class="n">colaFich</span><span class="p">[</span><span class="n">COLA</span><span class="p">][</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">inicio</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">final</span><span class="p">;</span>
<span class="p">}</span><span class="n">tCola</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
  <span class="kt">char</span> <span class="n">nombre</span><span class="p">[</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">pendientes</span><span class="p">;</span>
  <span class="n">tCola</span> <span class="n">colaImp</span><span class="p">;</span>
<span class="p">}</span><span class="n">tImpresora</span><span class="p">;</span>

<span class="n">tImpresora</span> <span class="n">lista</span><span class="p">[</span><span class="n">IMPRESORAS</span><span class="p">];</span><span class="c1">//lista esta declarada como variable global para simplificar el programa
</span>
<span class="c1">//Declaracion de las funciones
</span><span class="kt">int</span> <span class="n">colaLlena</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:colaLlena
*Descripcion: analiza si una cola esta llena
*Parametros de entrada: pcola: un puntero a la cola a analizar
*
*Parametros de salida: devuelve un entero. 1 si esta llena, 0 si no esta llena
*Parametros de entrada/salida:-----
*************************************************************/</span>
<span class="kt">int</span> <span class="n">colaVacia</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:colaVacia
*Descripcion:analiza si una cola esta vacia
*Parametros de entrada:pcola: un puntero a la cola a analizar
*
*Parametros de salida: devuelve 1 si esta vacia y 0 si no esta vacia
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">int</span> <span class="n">huecoLibre</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:huecoLibre
*Descripcion:busca huecos en la lista de impresoras
*Parametros de entrada:----
*
*Parametros de salida:devuelve un entero, la primera posicion
*                     libre en la lista o -1 si esta llena
*Parametros de entrada/salida:------
*************************************************************/</span>
<span class="kt">int</span> <span class="n">listaVacia</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:listaVacia
*Descripcion:analiza si la lista esta vacia
*Parametros de entrada:----
*
*Parametros de salida:devuelve el primer hueco ocupado en
*                       la lista o -1 si está vacia
*Parametros de entrada/salida:-------
*************************************************************/</span>
<span class="kt">int</span> <span class="n">listaLlena</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:listaLlena
*Descripcion:analiza si la lista esta llena
*Parametros de entrada:-----
*
*Parametros de salida:devuelve 0 si la lista tiene al
*                       menos un hueco libre, 1 si esta llena
*Parametros de entrada/salida:--------
*************************************************************/</span>
<span class="kt">void</span> <span class="n">meterCola</span><span class="p">(</span><span class="kt">char</span> <span class="n">cadena</span><span class="p">[],</span> <span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:meterCola
*Descripcion:pone una cadena de caracteres en una cola
*Parametros de entrada:cadena: la cadena que quieres meter
*                      pcola: puntero a la cola donde lo quieres meter
*Parametros de salida:---
*Parametros de entrada/salida:-----
*************************************************************/</span>
<span class="kt">int</span> <span class="n">enLista</span> <span class="p">(</span><span class="kt">char</span> <span class="n">buscar</span><span class="p">[]);</span>
<span class="cm">/*************************************************************
*Nombre:enLista
*Descripcion:busca en la lista una impresora
*Parametros de entrada:buscar:el nombre de la impresora que quieres buscar
*
*Parametros de salida:si lo encuentra, devuelve la posicion de la impresora
*                     si no, devuele -1
*Parametros de entrada/salida:-----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">mandarFicherosPorLote</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">tImpresora</span> <span class="o">*</span><span class="n">pimpresora</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:mandarFicherosPorLote
*Descripcion:manda n ficheros de argv a la cola de una impresora
*Parametros de entrada: argv: puntero a donde estan las cadenas
*                          que se van a meter en la cola
*                       n: el numero de ficheros a meter
*                       pimpresora: puntero a la impresora donde
*                           se van a meter las cadenas
*Parametros de salida:----
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">sacarCola</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">ficheroOut</span><span class="p">,</span> <span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:sacarCola
*Descripcion:saca 1 fichero de la cola
*Parametros de entrada: pcola: puntero a la cola de la que se quiere desencolar
*
*Parametros de salida: ficheroOut: donde se guarda el fichero sacado
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">imprimirCola</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:imprimirCola
*Descripcion:imprime toda una cola de impresion
*Parametros de entrada:pcola: puntero a la cola que se quiere imprimir
*
*Parametros de salida:----
*Parametros de entrada/salida:-----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">inicializarCola</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:inicializarCola
*Descripcion:inicializa una cola poniendo a 0 todos sus parametros
*Parametros de entrada:pcola:puntero a la cola que se quiere inicializar
*
*Parametros de salida:----
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">inicializarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:inicializarLista
*Descripcion:inicializa la lista poniendo a cero todos sus parametros
*Parametros de entrada:----
*
*Parametros de salida:-----
*Parametros de entrada/salida:-----
*************************************************************/</span>
<span class="kt">int</span> <span class="n">guardarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:guardarLista
*Descripcion:guarda el estado actual de la lista en un fichero externo
*Parametros de entrada:----
*
*Parametros de salida:devuelve 1 si la guarda correctamente, 0 si hay error
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">int</span> <span class="n">recuperarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:recuperarLista
*Descripcion:recupera una lista si encuentra una copia guardada
*Parametros de entrada:----
*
*Parametros de salida:devuelve 1 si la guarda correctamente, 0 si hay error
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">int</span> <span class="n">menu</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:menu
*Descripcion:muestra un menu y pide al usuario una opcion
*Parametros de entrada:---
*
*Parametros de salida:devuelve la opcion elegida
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">agregarImpresora</span><span class="p">(</span><span class="kt">int</span> <span class="n">numImpresora</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:agregarImpresora
*Descripcion:agrega una impresora a la lista
*Parametros de entrada:numImpresora:la posicion en la que se
*                           quiere almacenar la impresora
*Parametros de salida:----
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">leerFichero</span><span class="p">(</span><span class="kt">char</span> <span class="n">ficheroOut</span><span class="p">[</span><span class="mi">13</span><span class="p">]);</span>
<span class="cm">/*************************************************************
*Nombre:leerFichero
*Descripcion:lee un fichero de texto y lo muestra por salida estandar
*Parametros de entrada:ficheroOut: el nombre del fichero a imprimir
*
*Parametros de salida:----
*Parametros de entrada/salida:----
*************************************************************/</span>
<span class="kt">void</span> <span class="n">borrarImpresora</span><span class="p">(</span><span class="kt">int</span> <span class="n">queImp</span><span class="p">);</span>
<span class="cm">/*************************************************************
*Nombre:borrarImpresora
*Descripcion:borra una impresora de la lista
*Parametros de entrada:queImp:el numero de la impresora que se quiere borrar
*
*Parametros de salida:----
*Parametros de entrada/salida:----
*************************************************************/</span>

<span class="c1">//FUNCION PRINCIPAL
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">ficheroOut</span><span class="p">[</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">condicion</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">21</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">queImp</span><span class="p">;</span>

  <span class="n">condicion</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">recuperarLista</span><span class="p">())</span>
    <span class="n">inicializarLista</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span><span class="n">condicion</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">switch</span><span class="p">(</span><span class="n">menu</span><span class="p">())</span>
      <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">listaLlena</span><span class="p">())</span>
            <span class="n">agregarImpresora</span><span class="p">(</span><span class="n">huecoLibre</span><span class="p">());</span>
          <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"No quedan impresoras por agregar!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
          <span class="k">if</span><span class="p">(</span><span class="n">listaVacia</span><span class="p">()</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Impresoras disponibles:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s"</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Introduzca el nombre de la impresora: "</span><span class="p">);</span>
            <span class="n">fgets</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">stdin</span><span class="p">);</span>
            <span class="k">if</span><span class="p">((</span><span class="n">queImp</span><span class="o">=</span><span class="n">enLista</span><span class="p">(</span><span class="n">input</span><span class="p">))</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
              <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">6</span><span class="p">);</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"Mandando %d ficheros por lote a la impresora...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
              <span class="n">mandarFicherosPorLote</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">]);</span>
          <span class="p">}</span>
          <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Esa impresora no existe!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"La lista de impresoras esta vacia!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
          <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="sc">'\0'</span><span class="p">)</span>
            <span class="p">{</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"Ficheros en la cola de impresión de: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">);</span>
              <span class="n">imprimirCola</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colaImp</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
          <span class="k">if</span><span class="p">(</span><span class="n">listaVacia</span><span class="p">()</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Impresoras disponibles:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s"</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Introduzca el nombre de la impresora: "</span><span class="p">);</span>
            <span class="n">fgets</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">stdin</span><span class="p">);</span>
            <span class="k">if</span><span class="p">((</span><span class="n">queImp</span><span class="o">=</span><span class="n">enLista</span><span class="p">(</span><span class="n">input</span><span class="p">))</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">pendientes</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">0</span><span class="p">)</span>
              <span class="p">{</span>
                <span class="n">sacarCola</span><span class="p">(</span><span class="n">ficheroOut</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">colaImp</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Imprimiendo '%s'</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span><span class="n">ficheroOut</span><span class="p">);</span>
                <span class="n">leerFichero</span><span class="p">(</span><span class="n">ficheroOut</span><span class="p">);</span>
                <span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">pendientes</span><span class="o">--</span><span class="p">;</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Quedan %d ficheros en esta cola.</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">pendientes</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">else</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"No quedan ficheros por imprimir en esta cola!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"Esa impresora no existe!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"La lista de impresoras esta vacia!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
          <span class="k">if</span><span class="p">(</span><span class="n">listaVacia</span><span class="p">()</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Impresoras disponibles:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s"</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Introduzca el nombre de la impresora: "</span><span class="p">);</span>
            <span class="n">fgets</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">stdin</span><span class="p">);</span>
            <span class="k">if</span><span class="p">((</span><span class="n">queImp</span><span class="o">=</span><span class="n">enLista</span><span class="p">(</span><span class="n">input</span><span class="p">))</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
              <span class="n">borrarImpresora</span><span class="p">(</span><span class="n">queImp</span><span class="p">);</span>
            <span class="k">else</span>
              <span class="n">printf</span><span class="p">(</span><span class="s">"Esa impresora no existe!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"La lista de impresoras esta vacia!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
          <span class="n">guardarLista</span><span class="p">();</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">"Fin del programa. Lista guardada. Adios.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
          <span class="n">condicion</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span><span class="c1">//fin del switch
</span>      <span class="p">}</span><span class="c1">//fin del bucle
</span><span class="p">}</span><span class="c1">//fin de main
</span>


<span class="kt">int</span> <span class="nf">colaLlena</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">==</span><span class="p">((</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">COLA</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">colaVacia</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">==</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">huecoLibre</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="sc">'\0'</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">i</span><span class="p">;</span><span class="cm">/*Devuelve el primer hueco libre en la lista*/</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="cm">/*Devuele -1 si esta llena*/</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">listaVacia</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="sc">'\0'</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">i</span><span class="p">;</span><span class="cm">/*Devuelve el primer hueco ocupado en la lista*/</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="cm">/*Devuelve -1 si esta vacia*/</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">listaLlena</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="p">(</span><span class="sc">'\0'</span><span class="p">))</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">meterCola</span><span class="p">(</span><span class="kt">char</span> <span class="n">cadena</span><span class="p">[],</span> <span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">colaLlena</span><span class="p">(</span><span class="n">pcola</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="p">],</span><span class="n">cadena</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="p">],</span><span class="s">".txt"</span><span class="p">);</span>
    <span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="o">=</span><span class="p">((</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">COLA</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">enLista</span> <span class="p">(</span><span class="kt">char</span> <span class="n">buscar</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">,</span><span class="n">buscar</span><span class="p">)))</span>
      <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">mandarFicherosPorLote</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">tImpresora</span> <span class="o">*</span><span class="n">pimpresora</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">meterCola</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">pimpresora</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaImp</span><span class="p">);</span>
    <span class="n">pimpresora</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">pendientes</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sacarCola</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">ficheroOut</span><span class="p">,</span> <span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">colaVacia</span><span class="p">(</span><span class="n">pcola</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">ficheroOut</span><span class="p">,</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="p">]);</span>
    <span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">=</span><span class="p">((</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">COLA</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">imprimirCola</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;(</span><span class="n">COLA</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">COLA</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">%d.  "</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">+</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">%d.  "</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">-</span><span class="p">(</span><span class="n">COLA</span><span class="o">-</span><span class="n">i</span><span class="p">)]);</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inicializarCola</span><span class="p">(</span><span class="n">tCola</span> <span class="o">*</span><span class="n">pcola</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">inicio</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">final</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span><span class="n">COLA</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">pcola</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">colaFich</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inicializarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pendientes</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">inicializarCola</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colaImp</span><span class="p">);</span>
  <span class="p">}</span>


<span class="p">}</span>

<span class="kt">int</span> <span class="nf">guardarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">pfich</span><span class="p">;</span> <span class="cm">/* Referencia al fichero */</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">error</span><span class="p">;</span> <span class="cm">/* almacena si ha habido error */</span>
  <span class="n">error</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>


  <span class="k">if</span> <span class="p">((</span><span class="n">pfich</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s">"listaImpresoras.bin"</span><span class="p">,</span><span class="s">"w"</span><span class="p">))</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">lista</span><span class="p">);</span><span class="n">p</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">lista</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">IMPRESORAS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">tImpresora</span><span class="p">)));</span><span class="n">p</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">putc</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="n">pfich</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span> <span class="p">(</span><span class="n">pfich</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">error</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">recuperarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">pfich</span><span class="p">;</span> <span class="cm">/* Referencia al fichero */</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">error</span><span class="p">;</span> <span class="cm">/* almacena si ha habido error */</span>
  <span class="n">error</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">((</span><span class="n">pfich</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s">"listaImpresoras.bin"</span><span class="p">,</span><span class="s">"r"</span><span class="p">))</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">lista</span><span class="p">);</span><span class="n">p</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)(</span><span class="n">lista</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">IMPRESORAS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">tImpresora</span><span class="p">)));</span><span class="n">p</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="o">*</span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">getc</span><span class="p">(</span><span class="n">pfich</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span> <span class="p">(</span><span class="n">pfich</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">error</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">error</span><span class="p">;</span>
  <span class="p">}</span>

<span class="kt">int</span> <span class="nf">menu</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">opcion</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Menu</span><span class="se">\n</span><span class="s">Seleccione una opcion:</span><span class="se">\n\t</span><span class="s">1. Agregar impresora</span><span class="se">\n\t</span><span class="s">2. Mandar ficheros por lote a una impresora</span><span class="se">\n\t</span><span class="s">3. Listar todos los ficheros pendientes de imprimir</span><span class="se">\n\t</span><span class="s">4. Imprimir un fichero</span><span class="se">\n\t</span><span class="s">5. Borrar una impresora</span><span class="se">\n\t</span><span class="s">6. Salir</span><span class="se">\n</span><span class="s"> "</span><span class="p">);</span>
  <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
  <span class="n">fgets</span><span class="p">(</span><span class="n">opcion</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">stdin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">atoi</span><span class="p">(</span><span class="n">opcion</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">agregarImpresora</span><span class="p">(</span><span class="kt">int</span> <span class="n">numImpresora</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"Impresoras disponibles:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IMPRESORAS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s"</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nombre</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Introduzca un nombre para la impresora: "</span><span class="p">);</span>
  <span class="n">fgets</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="n">stdin</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">enLista</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">lista</span><span class="p">[</span><span class="n">huecoLibre</span><span class="p">()].</span><span class="n">nombre</span><span class="p">,</span><span class="n">input</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Esa impresora ya esta en la lista!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">leerFichero</span><span class="p">(</span><span class="kt">char</span> <span class="n">ficheroOut</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
<span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">lectura</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">letra</span><span class="p">;</span>
  <span class="n">lectura</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">ficheroOut</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">lectura</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span><span class="p">((</span><span class="n">letra</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">fgetc</span><span class="p">(</span><span class="n">lectura</span><span class="p">))</span><span class="o">!=</span><span class="n">EOF</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"%c"</span><span class="p">,</span><span class="n">letra</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Error al abrir el archivo.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">lectura</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">borrarImpresora</span><span class="p">(</span><span class="kt">int</span> <span class="n">queImp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">sacado</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"Borrando impresora %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">nombre</span><span class="p">);</span>

  <span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">pendientes</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">sacarCola</span><span class="p">(</span><span class="n">sacado</span><span class="p">,</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">colaImp</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Desencolando elemento '%s'</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">sacado</span><span class="p">);</span>
    <span class="n">leerFichero</span><span class="p">(</span><span class="n">sacado</span><span class="p">);</span>
    <span class="n">lista</span><span class="p">[</span><span class="n">queImp</span><span class="p">].</span><span class="n">pendientes</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Perdonad el posible nivel de spaghetti que pueda haber en el código, en el momento no estaba demasiado familiarizado con las formas estándar de hacer las cosas (y posiblemente ahora tampoco).</p>

<p>El problema de haber usado recursos extraños viene en las funciones <em>int recuperarLista(void)</em> e <em>int guardarLista(void)</em>. La parte de ficheros no la vimos muy en profundidad en las clases de teoría, así que yo la escribí de la forma que consideré que había que hacerlo.</p>

<p>Por ejemplo:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">guardarLista</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">pfich</span><span class="p">;</span> <span class="cm">/* Referencia al fichero */</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">error</span><span class="p">;</span> <span class="cm">/* almacena si ha habido error */</span>
  <span class="n">error</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>


  <span class="k">if</span> <span class="p">((</span><span class="n">pfich</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s">"listaImpresoras.bin"</span><span class="p">,</span><span class="s">"w"</span><span class="p">))</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">lista</span><span class="p">);</span><span class="n">p</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">lista</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">IMPRESORAS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">tImpresora</span><span class="p">)));</span><span class="n">p</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">putc</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="n">pfich</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span> <span class="p">(</span><span class="n">pfich</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">error</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Procedo a intentar explicarlo. Lo que había que guardar del programa era un array de impresoras (del tipo <em>tImpresora</em>). Entonces, en la función los pasos que sigo son los siguientes:</p>
<ul>
	<li>Abro el fichero para escribir</li>
	<li>Si se abre correctamente hago un bucle <em>for</em> que empieza en el puntero del array y acaba en el puntero resultante de la suma del puntero del array y el tamaño del tipo impresora multiplicado por el número de impresoras. De esta forma recorremos <strong>todo</strong> el array puntero a puntero.</li>
	<li>En cada iteración del <em>for</em> escribo en el fichero un "carácter". Da igual lo que hubiera en esa posición de memoria, yo escribo un carácter porque en C un char ocupa 1 byte exactamente.  Con esto consigo escribir todas las posiciones de memoria del array en el fichero.</li>
	<li>Cierro el fichero y salgo de la función.</li>
</ul>
<p>Con<em> recursos extraños</em> entiendo que el profesor pensaba que lo había copiado, plagiado o que me lo había hecho alguien. Le expliqué cómo funcionaba y cuando vio que lo entendía se dio por satisfecho y consideró que el código era mío, como ciertamente era.</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ricardosanz'; // required: replace example with your forum shortname
        var disqus_config = function () {
          this.page.url = 'http://ricardosa.nz/2015/Pr%C3%A1ctica-4-Prog-1/';
          this.page.identifier = '/2015/Práctica 4 Prog 1';
          this.page.title = 'Práctica 4 Prog 1';
        };
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">This work by Ricardo Sanz is licensed under a Creative Commons License <a href="http://creativecommons.org/licenses/by-sa/4.0/">BY-SA 4.0</a>.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64295510-1', 'auto');
  ga('send', 'pageview');
</script>


      <br>
    </div>
  </body>
</html>
